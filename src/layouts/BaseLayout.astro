---
import "../styles/global.css";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";

const {
  title = "Midway Wrestling Club",
  description = "Midway Wrestling Club offers focused, athletic training for youth wrestlers.",
} = Astro.props;
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="/logos/redhat_no_bg.png" />
    <link rel="apple-touch-icon" href="/logos/redhat_no_bg.png" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <meta name="theme-color" content="#0b0b0b" />
    <title>{title}</title>
    <slot name="head" />
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to content</a>
    <Nav />
    <main id="main">
      <slot />
    </main>
    <Footer />
    <div class="toast" data-toast role="status" aria-live="polite" hidden>
      <span data-toast-message>Link copied.</span>
    </div>
    <script is:inline>
      const callLinks = document.querySelectorAll("[data-call-button]");
      const canCall = window.matchMedia("(hover: none) and (pointer: coarse)").matches;

      if (!canCall && callLinks.length) {
        callLinks.forEach((link) => {
          link.addEventListener("click", (event) => {
            event.preventDefault();
          });
        });
      }

      const shareButtons = document.querySelectorAll("[data-share-url]");
      const toast = document.querySelector("[data-toast]");
      const toastMessage = toast?.querySelector("[data-toast-message]");
      let toastTimeout;

      if (shareButtons.length) {
        const showToast = (message) => {
          if (!toast) return;
          if (toastMessage) toastMessage.textContent = message;
          toast.hidden = false;
          toast.classList.add("is-visible");
          window.clearTimeout(toastTimeout);
          toastTimeout = window.setTimeout(() => {
            toast.classList.remove("is-visible");
            toast.hidden = true;
          }, 3000);
        };

        const copyToClipboard = async (value) => {
          if (navigator.clipboard?.writeText) {
            await navigator.clipboard.writeText(value);
            return true;
          }
          const textarea = document.createElement("textarea");
          textarea.value = value;
          textarea.setAttribute("readonly", "");
          textarea.style.position = "absolute";
          textarea.style.left = "-9999px";
          document.body.appendChild(textarea);
          textarea.select();
          const copied = document.execCommand("copy");
          document.body.removeChild(textarea);
          return copied;
        };

        shareButtons.forEach((button) => {
          button.addEventListener("click", async (event) => {
            event.preventDefault();
            const url = button.getAttribute("data-share-url");
            if (!url) return;
            const title = button.getAttribute("data-share-title") || undefined;
            const text = button.getAttribute("data-share-text") || undefined;
            const shareData = { url };
            if (title) shareData.title = title;
            if (text) shareData.text = text;

            if (typeof navigator !== "undefined" && typeof navigator.share === "function") {
              try {
                await navigator.share(shareData);
                return;
              } catch (err) {
                if (err && err.name === "AbortError") return;
              }
            }
            try {
              const copied = await copyToClipboard(url);
              if (copied) {
                showToast("Link copied.");
              } else {
                window.prompt("Copy this link:", url);
              }
            } catch (err) {
              window.prompt("Copy this link:", url);
            }
          });
        });
      }
    </script>
  </body>
</html>
