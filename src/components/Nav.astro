---
const navLinks = [
  { href: "/", label: "Home" },
  { href: "/schedule", label: "Schedule" },
  { href: "/coaches", label: "Coaches" },
  { href: "/faq", label: "FAQ" },
  { href: "/news", label: "News" },
  { href: "/membership", label: "Membership" },
];
---
<header class="site-header">
  <div class="container nav-wrap">
    <a class="logo" href="/" aria-label="Midway Wrestling Club">
      <img
        class="logo-mark"
        src="/logos/redhat_no_bg.png"
        alt=""
        width="38"
        height="38"
        loading="eager"
        decoding="async"
      />
      MWC
    </a>
    <nav class="nav-links" aria-label="Primary">
      {navLinks.map((link) => (
        <a href={link.href}>{link.label}</a>
      ))}
    </nav>
    <button
      class="menu-toggle"
      type="button"
      data-menu-button
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      Menu
    </button>
  </div>
</header>
<div class="mobile-menu" id="mobile-menu" data-menu hidden>
  <button
    class="mobile-menu__overlay"
    type="button"
    data-menu-overlay
    aria-hidden="true"
    tabindex="-1"
  ></button>
  <div
    class="mobile-menu__panel"
    data-menu-panel
    role="dialog"
    aria-modal="true"
    aria-label="Mobile navigation"
  >
    <div class="mobile-menu__header">
      <span class="logo">
        <img
          class="logo-mark"
          src="/logos/redhat_no_bg.png"
          alt=""
          width="38"
          height="38"
          loading="lazy"
          decoding="async"
        />
        MWC
      </span>
      <button class="menu-close" type="button" data-menu-close>
        Close
      </button>
    </div>
    <nav class="mobile-menu__links" aria-label="Mobile">
      {navLinks.map((link) => (
        <a href={link.href}>{link.label}</a>
      ))}
    </nav>
  </div>
</div>

<script is:inline>
  const menu = document.querySelector("[data-menu]");
  const menuPanel = document.querySelector("[data-menu-panel]");
  const menuButton = document.querySelector("[data-menu-button]");
  const menuClose = document.querySelector("[data-menu-close]");
  const menuOverlay = document.querySelector("[data-menu-overlay]");

  if (menu && menuPanel && menuButton) {
    let lastFocused = null;
    const focusableSelector =
      'a[href], button:not([disabled]), input, select, textarea, [tabindex]:not([tabindex="-1"])';

    const getFocusable = () =>
      Array.from(menuPanel.querySelectorAll(focusableSelector));

    const openMenu = () => {
      lastFocused = document.activeElement;
      menu.hidden = false;
      document.body.classList.add("menu-open");
      menuButton.setAttribute("aria-expanded", "true");
      const focusable = getFocusable();
      if (focusable.length) {
        focusable[0].focus();
      }
      document.addEventListener("keydown", handleKeydown);
    };

    const closeMenu = () => {
      menu.hidden = true;
      document.body.classList.remove("menu-open");
      menuButton.setAttribute("aria-expanded", "false");
      document.removeEventListener("keydown", handleKeydown);
      if (lastFocused && lastFocused.focus) {
        lastFocused.focus();
      }
    };

    const handleKeydown = (event) => {
      if (event.key === "Escape") {
        event.preventDefault();
        closeMenu();
        return;
      }
      if (event.key !== "Tab") return;
      const focusable = getFocusable();
      if (!focusable.length) return;
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      if (event.shiftKey && document.activeElement === first) {
        event.preventDefault();
        last.focus();
      } else if (!event.shiftKey && document.activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    };

    menuButton.addEventListener("click", openMenu);
    if (menuClose) menuClose.addEventListener("click", closeMenu);
    if (menuOverlay) menuOverlay.addEventListener("click", closeMenu);
    menuPanel.addEventListener("click", (event) => {
      if (event.target.closest("a")) {
        closeMenu();
      }
    });
  }
</script>
